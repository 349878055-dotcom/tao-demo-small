<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2S-Agent | 总司令位阶</title>
</head>
<body style="background:#f0f0f0; margin:0; font-family:sans-serif;">
    <div id="h" style="padding:20px; padding-bottom:100px;"></div>
    
    <div style="position:fixed; bottom:0; width:100%; background:#fff; padding:20px; border-top:2px solid #8C1515; display:flex; justify-content:center; z-index:9999;">
        <input id="ipt" type="text" placeholder="输入局面..." style="width:70%; padding:15px; border:1px solid #ddd; outline:none; font-size:16px;">
        <button id="btn" onclick="send()" style="padding:0 30px; background:#8C1515; color:#fff; border:none; cursor:pointer; font-weight:bold;">落子</button>
    </div>

    <script>
        // 核心：强制注入逻辑
        async function send() {
            const i = document.getElementById('ipt');
            const h = document.getElementById('h');
            const b = document.getElementById('btn');
            
            if(!i.value.trim()) return alert("请输入内容");
            
            // 锁定按钮，防止重复点击
            b.disabled = true;
            b.innerText = "降临中...";
            
            const q = i.value;
            h.innerHTML += `<div style="margin-bottom:20px; background:#fff; padding:15px; border-left:5px solid #8C1515;"><b>局面:</b> ${q}<br><span id='curr'>正在建立因果连接...</span></div>`;
            window.scrollTo(0, document.body.scrollHeight);

            try {
                // 强制对齐后端 /infer 接口
                const r = await fetch(`/infer?q=${encodeURIComponent(q)}`);
                const d = await r.json();
                document.getElementById('curr').innerText = d.answer;
            } catch(e) {
                document.getElementById('curr').innerText = "逻辑断裂：后端未响应，请检查 Render 状态。";
            } finally {
                document.getElementById('curr').id = '';
                i.value = '';
                b.disabled = false;
                b.innerText = "落子";
            }
        }
    </script>
</body>
</html>